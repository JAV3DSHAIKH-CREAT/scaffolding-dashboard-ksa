<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SCAFFOLDING MATERIAL DASHBOARD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-blue: #0d47a1;
            --accent-blue: #1565c0;
            --bg-color: #f4f7fc;
            --card-bg: #ffffff;
            --text-main: #333;
            --text-muted: #666;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
            color: white;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 { margin: 0; font-size: 24px; letter-spacing: 1px; }
        .status-badge { 
            display: inline-block; margin-top: 10px; padding: 5px 15px; 
            background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 12px; 
        }

        .container { max-width: 1200px; margin: auto; padding: 30px 20px; }

        /* Search Section */
        .search-container { position: relative; max-width: 800px; margin: 0 auto 40px; }
        
        .search-box {
            width: 100%;
            padding: 16px 20px;
            font-size: 18px;
            border-radius: 12px;
            border: 2px solid #ddd;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            box-sizing: border-box;
        }

        .search-box:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 4px 15px rgba(21, 101, 192, 0.2);
        }

        .suggestions {
            position: absolute;
            top: 100%; left: 0; right: 0;
            background: white;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            border: 1px solid #eee;
            border-top: none;
        }

        .suggestions div {
            padding: 14px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f9f9f9;
            transition: background 0.2s;
        }

        .suggestions div:hover { background-color: #e3f2fd; color: var(--primary-blue); font-weight: 500; }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--card-bg);
            padding: 25px 15px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-bottom: 5px solid transparent;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border-bottom-color: var(--accent-blue);
        }

        .card h3 {
            margin: 0;
            font-size: 14px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card .value {
            margin-top: 15px;
            font-size: 26px;
            font-weight: 800;
            color: var(--primary-blue);
        }

        @media (max-width: 600px) {
            .dashboard-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>SCAFFOLDING MATERIAL PROFESSIONAL DASHBOARD</h1>
    <div id="status" class="status-badge">ðŸ”„ Initializing Connection...</div>
</div>

<div class="container">
    <div class="search-container">
        <input type="text" id="searchInput" class="search-box" placeholder="Search by Column C (e.g. DOKA, BEAM)..." disabled>
        <div id="suggestions" class="suggestions"></div>
    </div>

    <div class="dashboard-grid">
        <div class="card"><h3>S013</h3><div class="value" id="valL">-</div></div>
        <div class="card"><h3>S022</h3><div class="value" id="valM">-</div></div>
        <div class="card"><h3>S012</h3><div class="value" id="valN">-</div></div>
        <div class="card"><h3>S015</h3><div class="value" id="valJ">-</div></div>
        <div class="card"><h3>S016</h3><div class="value" id="valK">-</div></div>
        <div class="card"><h3>S020</h3><div class="value" id="valI">-</div></div>
        <div class="card"><h3>NMP</h3><div class="value" id="valO">-</div></div>
        <div class="card"><h3>AUH</h3><div class="value" id="valQ">-</div></div>
        <div class="card"><h3>YARD</h3><div class="value" id="valF">-</div></div>
        <div class="card"><h3>HDEC - RENT</h3><div class="value" id="valP">-</div></div>
    </div>
</div>

<script>
    let masterData = [];
    const EXCEL_URL = 'data.xlsx'; // Make sure your file is named exactly this on GitHub

    // 1. Fetch Excel Automatically
    window.addEventListener('DOMContentLoaded', async () => {
        const statusEl = document.getElementById('status');
        try {
            const response = await fetch(EXCEL_URL + '?v=' + new Date().getTime());
            if (!response.ok) throw new Error("File not found");
            const arrayBuffer = await response.arrayBuffer();
            const data = new Uint8Array(arrayBuffer);
            const workbook = XLSX.read(data, { type: 'array' });
            
            const sheetName = "SCAFFOLDING MATERIAL OVERALL";
            const sheet = workbook.Sheets[sheetName];
            if (!sheet) throw new Error(`Sheet "${sheetName}" not found`);

            const raw = XLSX.utils.sheet_to_json(sheet, { header: 1 });
            
            // Handle Merged Cells in Column C (Index 2)
            const merges = sheet['!merges'] || [];
            merges.forEach(m => {
                if (m.s.c <= 2 && m.e.c >= 2) {
                    const firstVal = raw[m.s.r][2];
                    for (let r = m.s.r; r <= m.e.r; r++) {
                        if (raw[r]) raw[r][2] = firstVal;
                    }
                }
            });

            // Clean Data: Headers are Row 5, Data starts Row 7 (index 6)
            masterData = raw.slice(6).map(row => {
                if (row[2]) row[2] = row[2].toString().trim();
                return row;
            }).filter(row => row[2]);

            statusEl.innerText = `âœ… Connected: ${masterData.length} Items Syncing`;
            document.getElementById('searchInput').disabled = false;

        } catch (err) {
            statusEl.innerText = `âŒ Error: ${err.message}`;
            statusEl.style.background = "#d32f2f";
        }
    });

    const searchInput = document.getElementById('searchInput');
    const suggestionsBox = document.getElementById('suggestions');

    // 2. Search Logic
    searchInput.addEventListener('input', function() {
        const query = this.value.toLowerCase().trim();
        suggestionsBox.innerHTML = '';
        
        if (!query) {
            suggestionsBox.style.display = 'none';
            return;
        }

        const matches = masterData.filter(row => 
            row[2] && row[2].toLowerCase().includes(query)
        );

        if (matches.length > 0) {
            matches.slice(0, 15).forEach(row => {
                const div = document.createElement('div');
                div.textContent = row[2];
                div.onclick = () => selectItem(row);
                suggestionsBox.appendChild(div);
            });
            suggestionsBox.style.display = 'block';
        } else {
            suggestionsBox.style.display = 'none';
        }
    });

    // 3. Update Dashboard
    function selectItem(row) {
        searchInput.value = row[2];
        suggestionsBox.style.display = 'none';

        // Mapping based on your requirements
        const mapping = {
            'valL': 11, // S013
            'valM': 12, // S022
            'valN': 13, // S012
            'valJ': 9,  // S015
            'valK': 10, // S016
            'valI': 8,  // S020
            'valO': 14, // NMP
            'valQ': 16, // AUH
            'valF': 5,  // YARD
            'valP': 15  // HDEC - RENT
        };

        for (let [id, index] of Object.entries(mapping)) {
            const val = row[index];
            document.getElementById(id).innerText = (val === undefined || val === "") ? "0" : val;
        }
    }

    // Close suggestions on click outside
    document.addEventListener('click', (e) => {
        if (e.target !== searchInput) suggestionsBox.style.display = 'none';
    });
</script>

</body>
</html>
